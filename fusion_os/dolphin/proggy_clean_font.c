/*
 * proggy_clean_font.c - proggy clean bitmap font implementation
 * 
 * implements proggy clean tt font with bitmap data for terminal display
 */

#include "proggy_clean_font.h"
#include "framebuffer.h"
#include "../common/string.h"
#include "../common/logger.h"

/* proggy clean font bitmap data - simplified proggy clean tt */
static proggy_font_t proggy_font_data = {
    .glyph_width = PROGGY_FONT_WIDTH,
    .glyph_height = PROGGY_FONT_HEIGHT,
    .first_char = 0,
    .char_count = 128, /* basic ascii */
    .data = {
        /* space (32) */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* exclam (!) - 33 */
        0x08, 0x00, 0x08, 0x00, 0x08, 0x00, 0x08, 0x00,
        0x08, 0x00, 0x00, 0x00, 0x08, 0x00,
        
        /* quote (") - 34 */
        0x1c, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* hash (#) - 35 */
        0x00, 0x1c, 0x3e, 0x00, 0x1c, 0x00, 0x1c, 0x3e,
        0x1c, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* dollar ($) - 36 */
        0x08, 0x00, 0x3e, 0x00, 0x10, 0x00, 0x3e, 0x10,
        0x00, 0x00, 0x10, 0x00, 0x08, 0x00,
        
        /* percent (%) - 37 */
        0x30, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* ampersand (&) - 38 */
        0x00, 0x1c, 0x00, 0x1c, 0x00, 0x1c, 0x10, 0x1c,
        0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* apostrophe (') - 39 */
        0x08, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* left paren (() - 40 */
        0x00, 0x08, 0x10, 0x20, 0x20, 0x20, 0x20, 0x10,
        0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* right paren ()) - 41 */
        0x08, 0x00, 0x04, 0x00, 0x04, 0x00, 0x04, 0x00,
        0x04, 0x00, 0x08, 0x00, 0x00, 0x00,
        
        /* asterisk (*) - 42 */
        0x00, 0x00, 0x1c, 0x00, 0x08, 0x10, 0x00, 0x08,
        0x10, 0x00, 0x1c, 0x00, 0x00, 0x00,
        
        /* plus (+) - 43 */
        0x00, 0x00, 0x08, 0x00, 0x08, 0x3e, 0x08, 0x00,
        0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* comma (,) - 44 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
        0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* minus (-) - 45 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* period (.) - 46 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08,
        0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* slash (/) - 47 */
        0x00, 0x00, 0x00, 0x08, 0x10, 0x10, 0x20, 0x20,
        0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 0 - 48 */
        0x00, 0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 1 - 49 */
        0x00, 0x08, 0x18, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 2 - 50 */
        0x00, 0x1c, 0x22, 0x22, 0x20, 0x10, 0x08, 0x04,
        0x02, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 3 - 51 */
        0x00, 0x1c, 0x22, 0x22, 0x20, 0x18, 0x20, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 4 - 52 */
        0x00, 0x20, 0x20, 0x20, 0x20, 0x3e, 0x22, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 5 - 53 */
        0x00, 0x3e, 0x02, 0x02, 0x02, 0x1e, 0x20, 0x20,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 6 - 54 */
        0x00, 0x1c, 0x02, 0x02, 0x02, 0x1e, 0x22, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 7 - 55 */
        0x00, 0x3e, 0x20, 0x20, 0x20, 0x10, 0x08, 0x08,
        0x08, 0x08, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 8 - 56 */
        0x00, 0x1c, 0x22, 0x22, 0x22, 0x1c, 0x22, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* digit 9 - 57 */
        0x00, 0x1c, 0x22, 0x22, 0x22, 0x1c, 0x20, 0x20,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* colon (:) - 58 */
        0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x08,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* semicolon (;) - 59 */
        0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x08,
        0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* less than (<) - 60 */
        0x00, 0x00, 0x00, 0x10, 0x20, 0x40, 0x20, 0x10,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* equal (=) - 61 */
        0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x3e,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* greater than (>) - 62 */
        0x00, 0x00, 0x00, 0x40, 0x20, 0x10, 0x20, 0x40,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* question mark (?) - 63 */
        0x00, 0x1c, 0x22, 0x22, 0x22, 0x20, 0x10, 0x08,
        0x00, 0x08, 0x00, 0x00, 0x00, 0x00,
        
        /* at (@) - 64 */
        0x00, 0x0e, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
        0x11, 0x0e, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase A - 65 */
        0x00, 0x1c, 0x22, 0x22, 0x22, 0x3e, 0x22, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase B - 66 */
        0x00, 0x1e, 0x22, 0x22, 0x22, 0x1e, 0x22, 0x22,
        0x22, 0x1e, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase C - 67 */
        0x00, 0x1c, 0x22, 0x22, 0x02, 0x02, 0x02, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase D - 68 */
        0x00, 0x1e, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
        0x22, 0x1e, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase E - 69 */
        0x00, 0x3e, 0x02, 0x02, 0x02, 0x1e, 0x02, 0x02,
        0x02, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase F - 70 */
        0x00, 0x3e, 0x02, 0x02, 0x02, 0x1e, 0x02, 0x02,
        0x02, 0x02, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase G - 71 */
        0x00, 0x1c, 0x22, 0x22, 0x02, 0x02, 0x02, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase H - 72 */
        0x00, 0x22, 0x22, 0x22, 0x22, 0x3e, 0x22, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase I - 73 */
        0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase J - 74 */
        0x00, 0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x10, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase K - 75 */
        0x00, 0x22, 0x22, 0x22, 0x24, 0x28, 0x30, 0x28,
        0x24, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase L - 76 */
        0x00, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
        0x02, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase M - 77 */
        0x00, 0x22, 0x22, 0x22, 0x22, 0x2a, 0x2a, 0x2a,
        0x2a, 0x2a, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase N - 78 */
        0x00, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase O - 79 */
        0x00, 0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase P - 80 */
        0x00, 0x1e, 0x22, 0x22, 0x22, 0x1e, 0x02, 0x02,
        0x02, 0x02, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase Q - 81 */
        0x00, 0x1c, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
        0x22, 0x1c, 0x10, 0x00, 0x00, 0x00,
        
        /* uppercase R - 82 */
        0x00, 0x1e, 0x22, 0x22, 0x22, 0x1e, 0x12, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase S - 83 */
        0x00, 0x1c, 0x22, 0x22, 0x02, 0x1c, 0x20, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase T - 84 */
        0x00, 0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x08, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase U - 85 */
        0x00, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase V - 86 */
        0x00, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
        0x22, 0x14, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase W - 87 */
        0x00, 0x22, 0x22, 0x22, 0x22, 0x2a, 0x2a, 0x2a,
        0x2a, 0x2a, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase X - 88 */
        0x00, 0x22, 0x22, 0x22, 0x14, 0x08, 0x14, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase Y - 89 */
        0x00, 0x22, 0x22, 0x22, 0x22, 0x14, 0x08, 0x08,
        0x08, 0x08, 0x00, 0x00, 0x00, 0x00,
        
        /* uppercase Z - 90 */
        0x00, 0x3e, 0x20, 0x20, 0x10, 0x08, 0x04, 0x02,
        0x02, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* left bracket ([) - 91 */
        0x00, 0x3e, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
        0x02, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* backslash (\) - 92 */
        0x00, 0x00, 0x40, 0x20, 0x20, 0x10, 0x10, 0x08,
        0x08, 0x04, 0x00, 0x00, 0x00, 0x00,
        
        /* right bracket (]) - 93 */
        0x00, 0x3e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* caret (^) - 94 */
        0x00, 0x08, 0x08, 0x10, 0x20, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* underscore (_) - 95 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* grave accent (`) - 96 */
        0x00, 0x08, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase a - 97 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x20, 0x20,
        0x20, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase b - 98 */
        0x00, 0x02, 0x02, 0x02, 0x02, 0x1e, 0x22, 0x22,
        0x22, 0x1e, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase c - 99 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x22, 0x02,
        0x02, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase d - 100 */
        0x00, 0x20, 0x20, 0x20, 0x20, 0x3c, 0x22, 0x22,
        0x22, 0x3c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase e - 101 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x22, 0x3e,
        0x02, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase f - 102 */
        0x00, 0x1c, 0x10, 0x10, 0x10, 0x3e, 0x10, 0x10,
        0x10, 0x10, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase g - 103 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x22, 0x22,
        0x22, 0x3c, 0x20, 0x20, 0x22, 0x1c,
        
        /* lowercase h - 104 */
        0x00, 0x02, 0x02, 0x02, 0x02, 0x1e, 0x22, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase i - 105 */
        0x00, 0x00, 0x08, 0x00, 0x00, 0x1c, 0x08, 0x08,
        0x08, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase j - 106 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x08, 0x08,
        0x08, 0x08, 0x08, 0x10, 0x20, 0x00,
        
        /* lowercase k - 107 */
        0x00, 0x02, 0x02, 0x02, 0x02, 0x12, 0x14, 0x18,
        0x20, 0x20, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase l - 108 */
        0x00, 0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase m - 109 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x2a, 0x2a,
        0x2a, 0x2a, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase n - 110 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x22, 0x22,
        0x22, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase o - 111 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x22, 0x22,
        0x22, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase p - 112 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x22, 0x22,
        0x22, 0x1e, 0x02, 0x02, 0x00, 0x00,
        
        /* lowercase q - 113 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x22, 0x22,
        0x22, 0x1c, 0x20, 0x20, 0x00, 0x00,
        
        /* lowercase r - 114 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x12, 0x12,
        0x12, 0x12, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase s - 115 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x02, 0x1c,
        0x20, 0x1c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase t - 116 */
        0x00, 0x08, 0x08, 0x08, 0x08, 0x1c, 0x08, 0x08,
        0x08, 0x30, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase u - 117 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x22,
        0x22, 0x3c, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase v - 118 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x22,
        0x22, 0x14, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase w - 119 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x2a,
        0x2a, 0x2a, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase x - 120 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x14,
        0x14, 0x22, 0x00, 0x00, 0x00, 0x00,
        
        /* lowercase y - 121 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x22,
        0x22, 0x3c, 0x20, 0x20, 0x20, 0x1c,
        
        /* lowercase z - 122 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x20, 0x10,
        0x08, 0x3e, 0x00, 0x00, 0x00, 0x00,
        
        /* left brace ({) - 123 */
        0x00, 0x00, 0x08, 0x10, 0x10, 0x20, 0x20, 0x20,
        0x20, 0x10, 0x10, 0x08, 0x00, 0x00,
        
        /* pipe (|) - 124 */
        0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,
        0x08, 0x08, 0x08, 0x08, 0x08, 0x00,
        
        /* right brace (}) - 125 */
        0x00, 0x00, 0x10, 0x08, 0x08, 0x04, 0x04, 0x04,
        0x04, 0x08, 0x08, 0x10, 0x00, 0x00,
        
        /* tilde (~) - 126 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x14,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* delete (127) - 128 */
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        
        /* continue with rest of ascii... */
        /* this is a simplified proggy clean font for demonstration */
        /* for a complete implementation, all 256 characters would be defined */
    }
};

/* font character information cache */
static font_char_info_t char_info[PROGGY_FONT_CHARS];
static int font_initialized = 0;

/*
 * initialize proggy clean font
 */
int proggy_font_init(void) {
    if (font_initialized) {
        return 0;
    }
    
    LOG_INFO("proggy_font", "initializing proggy clean font");
    
    /* initialize character information for basic ascii */
    for (int i = 0; i < 128; i++) {
        char_info[i].width = proggy_font_data.glyph_width;
        char_info[i].height = proggy_font_data.glyph_height;
        char_info[i].bitmap_offset = i * proggy_font_data.glyph_width * proggy_font_data.glyph_height;
    }
    
    font_initialized = 1;
    LOG_INFO("proggy_font", "proggy clean font initialized");
    return 0;
}

/*
 * get font data pointer
 */
const proggy_font_t* proggy_font_get(void) {
    return &proggy_font_data;
}

/*
 * draw character to framebuffer
 */
void proggy_font_draw_char(void* framebuffer, int x, int y, uint8_t character, 
                          uint32_t foreground_color, uint32_t background_color, 
                          uint8_t attributes) {
    if (!font_initialized) {
        proggy_font_init();
    }
    
    /* clamp character to font range */
    character = character % PROGGY_FONT_CHARS;
    
    /* handle inverse attribute */
    if (attributes & TEXT_INVERSE) {
        uint32_t temp = foreground_color;
        foreground_color = background_color;
        background_color = temp;
    }
    
    /* calculate character bitmap location */
    const uint8_t* char_bitmap = &proggy_font_data.data[character * proggy_font_data.glyph_width * proggy_font_data.glyph_height];
    
    /* draw character bit by bit */
    for (int py = 0; py < proggy_font_data.glyph_height; py++) {
        for (int px = 0; px < proggy_font_data.glyph_width; px++) {
            int pixel_index = py * proggy_font_data.glyph_width + px;
            uint8_t pixel_bit = (char_bitmap[pixel_index / 8] >> (pixel_index % 8)) & 0x01;
            
            uint32_t pixel_color = background_color;
            if (pixel_bit) {
                pixel_color = foreground_color;
                
                /* handle bold attribute */
                if (attributes & TEXT_BOLD && px + 1 < proggy_font_data.glyph_width) {
                    /* draw extra pixel for bold effect */
                }
            }
            
            /* draw pixel */
            framebuffer_draw_pixel(x + px, y + py, pixel_color);
        }
    }
}

/*
 * draw text string to framebuffer
 */
void proggy_font_draw_text(void* framebuffer, int x, int y, const char* text, 
                          uint32_t foreground_color, uint32_t background_color, 
                          uint8_t attributes) {
    if (text == NULL) {
        return;
    }
    
    int current_x = x;
    while (*text != '\0') {
        proggy_font_draw_char(framebuffer, current_x, y, *text, 
                             foreground_color, background_color, attributes);
        current_x += proggy_font_data.glyph_width;
        text++;
    }
}

/*
 * measure text width
 */
int proggy_font_measure_text(const char* text) {
    if (text == NULL) {
        return 0;
    }
    
    int width = 0;
    while (*text != '\0') {
        width += proggy_font_data.glyph_width;
        text++;
    }
    return width;
}

/*
 * measure character width
 */
int proggy_font_measure_char(uint8_t character) {
    return proggy_font_data.glyph_width;
}

/*
 * get character information
 */
font_char_info_t* proggy_font_get_char_info(uint8_t character) {
    character = character % PROGGY_FONT_CHARS;
    return &char_info[character];
}

/*
 * get glyph bitmap data
 */
const uint8_t* proggy_font_get_glyph_data(uint8_t character, int* glyph_width, int* glyph_height) {
    character = character % PROGGY_FONT_CHARS;
    
    if (glyph_width) *glyph_width = proggy_font_data.glyph_width;
    if (glyph_height) *glyph_height = proggy_font_data.glyph_height;
    
    return &proggy_font_data.data[character * proggy_font_data.glyph_width * proggy_font_data.glyph_height];
}

/*
 * clear terminal text area
 */
void terminal_text_clear_area(terminal_text_area_t* area) {
    if (area == NULL) {
        return;
    }
    
    framebuffer_config_t* fb_config = framebuffer_get_config();
    if (fb_config == NULL) {
        return;
    }
    
    /* draw background */
    framebuffer_draw_rect(area->x, area->y, area->width, area->height, area->background_color);
}

/*
 * draw text line in terminal area
 */
void terminal_text_draw_line(terminal_text_area_t* area, int line, const char* text) {
    if (area == NULL || text == NULL || line < 0) {
        return;
    }
    
    framebuffer_config_t* fb_config = framebuffer_get_config();
    if (fb_config == NULL) {
        return;
    }
    
    int y = area->y + (line * proggy_font_data.glyph_height);
    if (y + proggy_font_data.glyph_height > area->y + area->height) {
        return;
    }
    
    proggy_font_draw_text(fb_config->lfb_address, area->x, y, text, 
                         area->foreground_color, area->background_color, area->attributes);
}

/*
 * draw character in terminal area
 */
void terminal_text_draw_char(terminal_text_area_t* area, int x, int y, uint8_t character) {
    if (area == NULL || x < 0 || y < 0) {
        return;
    }
    
    framebuffer_config_t* fb_config = framebuffer_get_config();
    if (fb_config == NULL) {
        return;
    }
    
    int px = area->x + (x * proggy_font_data.glyph_width);
    int py = area->y + (y * proggy_font_data.glyph_height);
    
    if (px + proggy_font_data.glyph_width > area->x + area->width ||
        py + proggy_font_data.glyph_height > area->y + area->height) {
        return;
    }
    
    proggy_font_draw_char(fb_config->lfb_address, px, py, character, 
                         area->foreground_color, area->background_color, area->attributes);
}